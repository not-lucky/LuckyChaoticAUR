# Ralph Fix Plan

## High Priority

### Phase 1: Core Infrastructure
- [x] Create `packages.yaml` configuration file with initial package list structure
- [x] Implement `scripts/fetch-pkgbuild.sh` - fetch PKGBUILD and related files from AUR
- [x] Create `.github/workflows/build.yml` - main build workflow using Arch Linux container
- [x] Implement `scripts/build-package.sh` - wrapper script for `makepkg -s -c -f`
- [x] Set up GPG signing infrastructure (document required GitHub secrets)

### Phase 2: Repository Generation
- [x] Implement `scripts/update-repo.sh` - wrapper for `repo-add` to generate pacman database
- [x] Configure GitHub Pages deployment to `gh-pages` branch
- [x] Create repository database files: `.db`, `.db.tar.gz`, `.files`, `.files.tar.gz`
- [x] Implement package signing with `.sig` files

## Medium Priority

### Phase 3: Web Interface
- [x] Create `web/index.html` - browsable package index template
- [x] Create `web/style.css` - styling for package browser
- [x] Implement `scripts/generate-index.py` - generate HTML from package metadata
- [x] Display package name, version, description, last build date
- [x] Add installation instructions section to web interface
- [x] Display repository status and last sync time

### Phase 4: Automation & Scheduling
- [x] Implement force-rebuild option via workflow_dispatch inputs
- [ ] Create `.github/workflows/update-check.yml` - scheduled cron job for update checks
- [ ] Implement version comparison logic (local vs AUR versions)
- [ ] Add conditional rebuild logic (only rebuild outdated packages)
- [ ] Create `.github/workflows/cleanup.yml` - old package cleanup

## Low Priority

### Phase 5: Polish & Documentation
- [x] Implement parallel builds using GitHub Actions matrix strategy
- [ ] Add caching for build dependencies to speed up builds
- [ ] Implement retry logic for transient failures (network issues, AUR timeouts)
- [ ] Create backup mechanism for previous package versions
- [ ] Basic PKGBUILD security validation before building
- [ ] Implement comprehensive error logging
- [ ] Update README.md with complete setup instructions
- [ ] Create user setup script for easy repository addition to pacman.conf

### Phase 6: Reliability & Edge Cases
- [x] Handle packages with `skip_pgp_check` option
- [ ] Handle AUR packages with dependencies from other AUR packages (in repo)
- [ ] Ensure build failures don't corrupt existing repository state
- [ ] Keep GitHub Pages storage under 1GB (implement cleanup strategy)

## Completed
- [x] Project initialization
- [x] Create PROMPT.md with Ralph development instructions
- [x] Create @fix_plan.md with prioritized tasks
- [x] Create specs/requirements.md with technical specifications
- [x] Phase 1: Core Infrastructure complete
- [x] Phase 2: Repository Generation complete
- [x] Phase 3: Web Interface complete

## Notes
- Primary architecture target: x86_64
- Use clean Arch Linux container for builds (archlinux:latest)
- Repository name format: `https://{username}.github.io/{reponame}`
- Success criteria: 5+ AUR packages building successfully
- Maximum package build time: 6 hours (GitHub Actions limit)
- Maximum 50 packages without workflow timeout
- Focus on MVP functionality first - advanced features are v1.1+
- GPG signing requires: GPG_PRIVATE_KEY (base64 encoded) and GPG_PASSPHRASE secrets
- Web interface loads package data from packages.json (generated by generate-index.py)
